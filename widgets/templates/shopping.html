{% extends 'layout.html' %}
{% load static %}
{% block head %}
<link rel="stylesheet" href="{% static 'styles/shopping.css' %}">
{% endblock head %}
{% block body %}
<div class="shopping-container">
    <div class="heading">
        <h1>
            shopping list
        </h1>
    </div>

    <div class="content">
    <div class="form-container">
        <div class="heading">
            <h1>add a item</h1>
        </div>
        <form action="{% url 'widget:shopping' %}" method="POST">
            {% csrf_token %}
            <label for="item name">item name:</label> <br>
            <input type="text" placeholder="item name" name="item-name">
            <label for="item link"> item link:</label> <br>
            <input type="text" name="item-link" placeholder="item link">
            <label for="price">enter price:</label> <br>
            <input type="text" name="item-price" placeholder="Enter amount (e.g., 2000 or 2000.50)" id="">
            <label for="item-priority">item type:</label> <br>
            <select name="item-priority" id="item-priority">
                <option value="want">Want</option>
                <option value="need">Need</option>
            </select>
            <button type="submit">submit</button>
        </form>
    </div>
    {% if list_exists %}
    <div class="goods-container">
        <div class="heading">
            <h1>goods</h1>
        </div>
        <div class="table-container">
            <table class="shopping-table">
                <thead>
                    <tr>
                        <th>Item Name</th>
                        <th>Link</th>
                        <th>Price</th>
                        <th>Type</th>
                        <th>Budget Status</th>
                        <th>Actions</th>
                        </tr>
                </thead>
                <tbody>
                {% for item in shopping_items %}
                    <tr>
                        <td>{{ item.name }}</td>
                        <td>
                            {% if item.link %}
                                <a href="{{ item.link }}" target="_blank" class="item-link">view</a>
                            {% else %}
                                —
                            {% endif %}
                        </td>
                        <td>₹{{ item.price }}</td>
                        <td>{% if item.priority %}Need{% else %}Want{% endif %}</td>
                        <td class="affordability-status">
                            <span class="status-message">{{ item.affordability_message }}</span>
                        </td>
                        <td style="white-space:nowrap;">
                            <a href="{% url 'widget:edit_item' item.id %}" class="action-btn edit-btn">Edit</a>
                            <form action="{% url 'widget:buy_item' item.id %}" method="post" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="action-btn bought-btn" 
                                        {% if not item.can_afford %}disabled title="Cannot afford this item"{% endif %}>
                                    Buy
                                </button>
                            </form>
                            <form action="{% url 'widget:remove_item' item.id %}" method="post" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="action-btn remove-btn" onclick="return confirm('Remove this item from your list?')">
                                    Remove
                                </button>
                            </form>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="3" style="text-align:center; color:#aaa;">No items yet.</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    </div>
    {% endif %}

</div>
{% endblock body %}